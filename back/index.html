<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Wait while redirecting...</title>
    <script>
      const currentUrl = new URL(window.location.href)
      const { searchParams } = currentUrl
      const zoneParam = searchParams.get('z')
      const domain = searchParams.get('domain')
      const urlParam = searchParams.get('url')

      searchParams.delete('z')
      searchParams.delete('domain')
      searchParams.delete('url')

      if (urlParam) {
        const separator = urlParam.includes('?') ? '&' : '?';
        window.location.href = `${urlParam}${separator}${searchParams.toString()}`;
      } else if (zoneParam && domain) {
        // Clean domain: remove pathname, search params, and hash
        let cleanDomain;
        try {
          const domainUrl = new URL(domain);
          cleanDomain = `${domainUrl.protocol}//${domainUrl.host}`;
        } catch (e) {
          // If parsing fails, try manual cleaning
          let hostPart = domain.replace(/^https?:\/\//, '').split('/')[0].split('?')[0].split('#')[0];
          const protocol = domain.startsWith('http://') ? 'http://' : 'https://';
          cleanDomain = protocol + hostPart;
        }
        window.location.replace(`${cleanDomain}/afu.php?${searchParams}`)
      } else {
        window.location.href = 'https://google.com'
        console.error('Zone param or url param were missed')
      }
    </script>
  </head>

  <body>
    <div style="display: flex; justify-self: center; align-items: center; height: 100vh">
      <h1>Wait while redirecting...</h1>
    </div>
  </body>
</html>
